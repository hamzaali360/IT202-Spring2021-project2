<!DOCTYPE html>
<html>
  <style>
    /* p{
      height: 50%;
      width: 50%;
    } */
    </style>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>repl.it</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <script src="script.js"></script>
    <canvas id='game' width='500' height='500'></canvas>

  </body>
  <script>
  let canvas = document.querySelector("canvas");
  canvas.style.backgroundColor = "silver";
  let context = canvas.getContext("2d");
  let x = canvas.width / 2;
  let y = canvas.height / 2;
  let space = new Image();
 
  space.src = "images/space.webp" 

  let rocket = new Image();
  rocket.src = "images/rocket.png";
  let player = {x: 0, y: canvas.height/2,radius: 7, speed: 4}

  let asteroids = new Image();
  asteroids.src = "images/asteroids.png";
  //let enemy = {x: canvas.width + 50, radius: 50}
 let enemys =[];
 asteroidMaker();
 
  let ui = {life: 3, score: 0, level: 1}

  let gameStart = false;
  let restartSpeed = 2;

      context.font = '30pt Calibri';
      context.textAlign = 'center';
      context.fillStyle = 'blue';
      context.fillText('Space Adventure', x, y);
      context.font = '15pt Calibri';
      context.fillText('Press space to start', x, y+65);
      context.fillText('You are traveling through space, you need to avoid the', x, y+30);
      context.fillText('asteroids while traveling through space', x, y+47);
      context.fillText('Up Direction: Up arrow key', x-140, y+150);
      context.fillText('Down Direction: Down arrow key', x-115, y+165);
      context.fillText('Collects stars to get bonus points', x-115, y+200);
      context.fillText('Collects hammers to get extra life', x-115, y+220);

      document.addEventListener("keydown", function(event) {
        if(event.which == "32" & gameStart == false)
        {
          gameStart = true;
          // ui.score = 0;
          // ui.life = 3;
          // ui.level = 1;
          // enemys.forEach( (asteroid) => {
          //   asteroid.speed = 2;
          //   asteroid.x = 550
          // });
          // player.speed = 4;
          canvas.style.backgroundColor = "";
          console.log(event.which);
          draw();
          startGame();
        }
  
})
function asteroidMaker(){
  
  for (let i = 0; i<5; i++)
          {
          enemys.push(
            {
              
              x: Math.floor(Math.random() * (canvas.width +50) + canvas.width), 
              y: Math.floor(Math.random() * canvas.height),
              radius: 35,
              //type: "harm",
              image: "images/asteroids.png",
              speed: 2});
          }       
}

let draw= () =>{
  context.clearRect(0,0,500,500);
  context.drawImage(space,0,0);

  context.drawImage(rocket,player.x,player.y - 25,50,50);
  // context.beginPath();
  // context.arc(player.x,player.y,player.radius,0,Math.PI*2);
  // context.closePath();
  // context.fillStyle = "red";
  // context.fill();

  enemys.forEach ( (asteroid) =>{
    
  context.drawImage(asteroids, asteroid.x - 20,asteroid.y - 50, 100, 100);
  // context.beginPath();
  // context.arc(asteroid.x,asteroid.y,asteroid.radius,0,Math.PI*2);
  // context.closePath();
  // context.fillStyle = "red";
  // context.fill();
  
});
respawnAstoroid();
levelIncrease();
gameOver();
enemys.forEach( (asteroid) => {
    asteroid.x -= asteroid.speed;
    if(areColliding(player, asteroid))
    {
      // console.log("hit");
      asteroid.x = 550;
       asteroid.y =Math.floor(Math.random() * canvas.height);
       ui.life -= 1;
    }
  })
  context.fillStyle = 'white';
  context.font = '15pt Calibri';
  context.fillText('Score: ' + ui.score, x+170, y-230);
  context.fillText('Level: ' + ui.level, x, y-230);
  context.fillText('Life: ' + ui.life, x-220, y-230);
  
  window.requestAnimationFrame(draw);
}
function levelIncrease()
{
  if(ui.score % 2000 == 0 & ui.score > 0)
  {
    ui.score += 10;
    ui.level += 1;
    enemys.forEach( (asteroid) => {
    asteroid.speed += 1;
  })
  }
}
// function restart()
// {
//    document.addEventListener("keydown", function(event) {
//     if(event.which == "32" & gameStart == false)
//         {
//   gameStart = true;
//   ui.score = 0;
//   ui.life = 3;
//   ui.level = 1;    
//   enemys.forEach( (asteroid) => {
//     asteroid.speed = 2;
//    // asteroid.speed /= restartSpeed;
    
//     asteroid.x = 550
//     console.log(asteroid.speed);
//     });

//   player.speed = 4;
//  // player.speed /=restartSpeed;
//   console.log(player.speed);
//   player.y = y - 25;
//   //restartSpeed +=2;
//         }
//    });
// }
function gameOver()
{
  if(ui.life == 0)
  {
    enemys.forEach( (asteroid) => {
    asteroid.speed = 0;
  })
  player.speed = 0;
  context.font = '60pt Calibri';
  context.fillText('Game Over', x, y);
  gameStart = false;
  //restart();
  }
}
function startGame()
{

  //context.drawImage(rocket,player.x,player.y,50,50);
  document.addEventListener('keydown', (event) => {
    if (event.code == "ArrowUp" & player.y > 0){
      player.y -= player.speed;
      console.log(player.y)
    }else if(event.code == "ArrowDown" & player.y < 458){
      player.y += player.speed;
      console.log(player.y)
    } 
  }) 
}  

function areColliding(obj1, obj2){
      let dx = obj1.x - obj2.x;
      let dy = obj1.y - obj2.y;
      let distance = Math.sqrt(dx * dx + dy * dy);
      if (distance < obj1.radius + obj2.radius) {
        return true;

    }
      return false;
    }

function respawnAstoroid()
{
  enemys.forEach( (asteroid) => {
    if(asteroid.x < -80){
      asteroid.y =  Math.floor(Math.random() * canvas.height)
      asteroid.x = 550;
      ui.score += 10;
    }
  });
}
  </script>
</html>